@page "/complete-login"
@inject NavigationManager Navigation
@inject HttpClient HttpClient
@inject IJSRuntime JSRuntime

@code { // This is the code block for the complete login page
    [Parameter]
    [SupplyParameterFromQuery]
    public string? Email { get; set; }

    [Parameter]
    [SupplyParameterFromQuery]
    public bool Remember { get; set; }

    // This is the initialization handler
    protected override async Task OnInitializedAsync()
    {
        if (!string.IsNullOrEmpty(Email)) // Check if email is provided
        {
            try
            {
                var request = new { Email = Email, Remember = Remember }; // Create the request object
                var baseUrl = Navigation.BaseUri;
                var response = await HttpClient.PostAsJsonAsync($"{baseUrl}api/auth/signin", request);
                
                if (response.IsSuccessStatusCode)
                {
                    // Wait a moment for authentication to complete
                    await Task.Delay(500);
                    // Force a complete page reload
                    await JSRuntime.InvokeVoidAsync("location.replace", "/");
                    return;
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Sign-in error: {ex.Message}"); // Log the error message
            }
        }
        Navigation.NavigateTo("/");
    }


}